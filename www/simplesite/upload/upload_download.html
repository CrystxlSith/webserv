<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>HTTP File Upload / Download / Delete Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 500px;
            margin: 50px auto;
        }
        h2 {
            border-bottom: 1px solid #ccc;
            padding-bottom: 5px;
        }
        input[type="text"], input[type="file"] {
            width: 100%;
            padding: 6px;
            margin: 8px 0;
        }
        button {
            padding: 8px 16px;
            margin-top: 10px;
        }
        .status {
            margin-top: 10px;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <h2>üì§ Upload File (POST)</h2>
    <form id="uploadForm" method="POST" action="/upload" enctype="multipart/form-data">
        <input type="file" name="file" required>
        <button type="submit">Upload</button>
    </form>
    <div id="uploadStatus" class="status"></div>
    <div id="uploadLink" class="status"></div>

    <h2>üì• Download File (GET)</h2>
    <form onsubmit="downloadFile(event)">
        <input type="text" id="filename" placeholder="Enter filename (e.g., test.txt)" required>
        <button type="submit">Download</button>
    </form>

    <h2>üóëÔ∏è Delete File (DELETE)</h2>
    <form onsubmit="deleteFile(event)">
        <input type="text" id="deleteFilename" placeholder="Enter filename to delete" required>
        <button type="submit" style="background-color: #d9534f; color: white;">Delete</button>
    </form>
    <div id="deleteStatus" class="status"></div>

    <script>
        // Clear status messages after delay
        function clearStatusMessages() {
            setTimeout(() => {
                document.getElementById('uploadStatus').textContent = '';
                document.getElementById('uploadLink').textContent = '';
                document.getElementById('deleteStatus').textContent = '';
            }, 5000);
        }

        // Upload file via JavaScript
        document.getElementById('uploadForm').addEventListener('submit', function (event) {
            event.preventDefault();

            const fileInput = event.target.querySelector('input[type="file"]');
            const file = fileInput.files[0];
            if (!file) return;

            const formData = new FormData();
            formData.append('file', file);

            const safeFilename = encodeURIComponent(file.name);

            fetch('/upload', {
                method: 'POST',
                body: formData
            })
            .then(res => res.text())
            .then(responseText => {
                document.getElementById('uploadStatus').textContent = "‚úÖ Upload successful!";
                document.getElementById('uploadLink').innerHTML =
                    `üîó <a href="/upload/${safeFilename}" download>Download ${file.name}</a>`;
                clearStatusMessages();
            })
            .catch(error => {
                document.getElementById('uploadStatus').textContent = "‚ùå Upload failed.";
                document.getElementById('uploadLink').textContent = "";
                console.error(error);
                clearStatusMessages();
            });
        });

        // Download file via GET
        function downloadFile(event) {
            event.preventDefault();
            const filename = document.getElementById('filename').value.trim();
            if (!filename) return;

            const url = `/upload/${encodeURIComponent(filename)}`;
            window.location.href = url;
        }

        // Delete file via DELETE
        function deleteFile(event) {
            event.preventDefault();
            const filename = document.getElementById('deleteFilename').value.trim();
            if (!filename) return;

            fetch(`/upload/${encodeURIComponent(filename)}`, {
                method: 'DELETE'
            })
            .then(res => res.text().then(msg => ({ status: res.status, msg })))
            .then(({ status, msg }) => {
                if (status === 200 || status === 204) {
                    document.getElementById('deleteStatus').textContent = `‚úÖ File "${filename}" deleted successfully.`;
                } else if (status === 404) {
                    document.getElementById('deleteStatus').textContent = `‚ùå File "${filename}" not found.`;
                } else if (status === 403) {
                    document.getElementById('deleteStatus').textContent = `üö´ Permission denied to delete "${filename}".`;
                } else {
                    document.getElementById('deleteStatus').textContent = `‚ùå Failed to delete file: ${msg}`;
                }
                clearStatusMessages();
            })
            .catch(error => {
                document.getElementById('deleteStatus').textContent = "‚ùå Error deleting file.";
                console.error(error);
                clearStatusMessages();
            });
        }
    </script>

</body>
</html>
